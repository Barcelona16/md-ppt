<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Markdown PPT Player</title>
    <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/player.css">
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="js/jquery.mobile.custom.min.js"></script>
    <script src="http://jgm.github.io/stmd/js/stmd.js"></script>
    <script src="js/player.js"></script>
    <script src="js/air.play.js"></script>
    <script src="js/settings.js"></script>
    <script src="http://cdn.bootcss.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/zeroclipboard/2.1.6/ZeroClipboard.min.js"></script>
</head>
<body>
<!-- Static navbar -->
<div class="navbar navbar-default navbar-static-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/player.html">Come Soon</a>
        </div>
        <div class="navbar-collapse collapse">
            <div class="navbar-form navbar-left" onsubmit="return false" role="search">
                <div class="input-group">
                    <span class="input-group-addon">Air Play</span>
                    <input id="input_host" type="url" class="form-control" autocomplete>
                    <span class="input-group-addon btn"
                          onclick="var ws = $('#input_host');window.airPlay.connect(ws.val());window.settings.save(ws.val())">
                        <span class="glyphicon glyphicon-ok"></span>
                    </span>
                </div>

                <div class="input-group">
                    <span class="input-group-addon">Code</span>
                    <input id="input_code" type="number" min="100000" max="999999" class="form-control">
                    <span class="input-group-addon btn" onclick="window.airPlay.join($('#input_code').val())">
                        <span class="glyphicon glyphicon-ok"></span>
                    </span>
                </div>
            </div>

            <div class="navbar-form navbar-right" onsubmit="return false" role="status">
                <div class="btn-group">
                    <button class="btn btn-info" id="air_code" onclick="$('#qrcode_modal').modal()">
                        <strong>^-^</strong>
                    </button>
                    <button class="btn btn-danger" id="air_status">Offline</button>
                    <button class="btn btn-primary" id="btn_full_screen"
                            onclick="window.player.fullScreen('#main')"
                            data-toggle="tooltip" data-placement="left" title="Full screen">
                        <span class="glyphicon glyphicon-fullscreen"></span>
                    </button>
                </div>
            </div>

        </div>
    </div>
</div>
<div class="container">
    <div id="main" class="panel-dashed">
        <div id="player">
            <div id="drop_zone" class="text-center">
                <div id="drop_zone_header">
                    Drop markdown file
                </div>
            </div>
            <div id="play_zone"></div>
        </div>
    </div>
</div>
<!-- Modal -->
<div class="modal fade" id="qrcode_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span
                        class="sr-only">Close</span></button>
                <h4 class="modal-title" id="qrcode_modal_label">Share</h4>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <input id="input_share" class="form-control" readonly type="url"
                           value="https://github.com/aiyanbo/md-ppt">
                    <span class="input-group-addon btn" id="btn_copy"
                          data-clipboard-text="https://github.com/aiyanbo/md-ppt">
                        <span class="glyphicon glyphicon-camera"></span>
                    </span>
                </div>
                <div id="qrcode" class="input-group">
                    <img id="img_qrcode"
                         src="http://api.qrserver.com/v1/create-qr-code/?data=https%3A%2F%2Fgithub.com%2Faiyanbo%2Fmd-ppt">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div class="footer">
    <div class="container">
        <span>Copyright: <a href="http://weibo.com/aiyboo">NinetyH</a> &copy; 2014.</span>
        <span>Source: <a href="https://github.com/aiyanbo/md-ppt">https://github.com/aiyanbo/md-ppt</a></span>
    </div>
</div>
</body>
<script>
    $('#btn_full_screen').tooltip();

    window.player = new Player({
        onplay: function (event) {
            window.airPlay.send({"type": "play", "data": event.data});
        },
        onreadend: function (event) {
            var message = {};
            message.type = "pull";
            message.data = {
                "type": "markdown",
                "data": window.player.getMarkdown(),
                "index": window.player.getIndex()
            };
            window.airPlay.send(message);
        }
    });
    window.player.setSwipeEvent("#main");

    window.airPlay = new AirPlay({
        onopen: function (event) {
            var args = "code=" + event.data + "&ws=" + event.url;
            var share = window.location.origin + "/player.html?" + args;
            $("#input_share").val(share);
            $("#input_host").val(event.url);
            $("#btn_copy").attr("data-clipboard-text", share);
            $("#img_qrcode").attr("src",
                            "http://api.qrserver.com/v1/create-qr-code/?data="
                            + encodeURIComponent(window.location.origin + "/mobile.html?" + args));
        },
        onpush: function (event) {
            var message = {};
            message.type = "pull";
            message.data = {
                "type": "markdown",
                "data": window.player.getMarkdown(),
                "index": window.player.getIndex()
            };
            window.airPlay.send(message);
        },
        onpull: function (event) {
            window.player.sync(event.data);
        },
        onplay: function (event) {
            window.player.play(event.data);
        }
    });

    window.settings = new Settings({
        onok: function (ws, code) {
            window.airPlay.connect(ws, code);
            $("#input_host").val(ws);
            $("#input_code").val(code);

        },
        onws: function (ws) {
            window.airPlay.connect(ws);
            $("#input_host").val(ws);
        }
    });

    window.settings.set();

    var zeroClipboard = new ZeroClipboard(document.querySelector("#btn_copy"));
    zeroClipboard.on("ready", function (readyEvent) {
        console.log("ZeroClipboard is on ready.");
        var bridge = $("#global-zeroclipboard-html-bridge");
        bridge.tooltip({"placement": "top", "trigger": "click hover"})
                .attr('data-original-title', 'Copy to clipboard');

        bridge.on("mouseout", function (event) {
            $("#global-zeroclipboard-html-bridge")
                    .attr('data-original-title', 'Copy to clipboard')
                    .tooltip('fixTitle');
        }).on("click", function (event) {
            $("#global-zeroclipboard-html-bridge")
                    .attr('data-original-title', 'Copied!')
                    .tooltip('toggle');
        });
    });
</script>
</html>